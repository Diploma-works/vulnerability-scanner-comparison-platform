import React, {useEffect, useState} from 'react';
import {VulnerabilityGroup, VulnerabilityType} from "../api/catalog-service-client";
import clientFacade from "../api/ClientFacade";
import {Simulate} from "react-dom/test-utils";
import error = Simulate.error;

const VulnerabilitiesPage = () => {

  const [vulnerGroups, setVulnerGroups] = useState<VulnerabilityGroup[]>([])
  const [vulnerTypes, setVulnerTypes] = useState<VulnerabilityType[]>([])

  useEffect(() => {
    clientFacade.catalogServiceClient.external.getVulnerabilityGroups()
      .then((response) => {
        setVulnerGroups(response.groups)
        console.log(response)
      })
      .catch((error) => {
        console.log(error.message)
      })

    clientFacade.catalogServiceClient.external.getVulnerabilities()
      .then((response) => {
        setVulnerTypes(response.types)
        console.log(response)
      })
    .catch((error) => {
        console.log(error.message)
      })
  }, []);

  return (
    <div className="box m-5">
      <div className="columns">
        <div className="column is-half">
          <div className="is-size-6 has-text-weight-bold has-text-centered">Группы уязвимостей</div>
          <table className="mt-3 table is-bordered is-fullwidth">
            <thead>
              <tr>
                <td>Порядковый номер</td>
                <td>Название группы</td>
                <td>Количество очков</td>
              </tr>
            </thead>
            <tbody>
            {vulnerGroups.map((group) => (
              <tr>
                <td>{group.id}</td>
                <td>{group.name}</td>
                <td>{group.score.toFixed(2)}</td>
              </tr>
            ))}
            </tbody>
          </table>
        </div>
        <div className="column is-half">
          <div className="is-size-6 has-text-weight-bold has-text-centered">Типы уязвимостей</div>
          <table className="mt-3 table is-bordered is-fullwidth">
            <thead>
              <tr>
                <td>Название типа уязвимости</td>
                <td>Номер группы уязвимости</td>
              </tr>
            </thead>
            <tbody>
            {vulnerTypes.map((type) => (
              <tr>
                <td>{type.name}</td>
                <td>{type.group_id}</td>
              </tr>
            ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

export default VulnerabilitiesPage;