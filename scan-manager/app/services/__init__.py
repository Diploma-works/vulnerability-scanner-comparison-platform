from fastapi import Depends, Request

from app.clients import get_catalog_service_client
from app.clients.catalog_service import CatalogServiceClient
from app.db import get_repository
from common.ScanContainerInfoRepository import ScanContainerInfoRepository
from common.ScanRepository import ScanRepository
from app.services.ScanService import ScanService
from app.services.ScannerManager import ScannerManager


def get_scanner_manager(
        request: Request
) -> ScannerManager:
    return request.app.state.scanner_manager


def get_scan_service(
        scan_repository: ScanRepository = Depends(get_repository(ScanRepository)),
        scan_cont_info_repository: ScanContainerInfoRepository = Depends(get_repository(ScanContainerInfoRepository)),
        scanner_manager: ScannerManager = Depends(get_scanner_manager),
        catalog_service_client: CatalogServiceClient = Depends(get_catalog_service_client)
) -> ScanService:
    return ScanService(scan_repository, scan_cont_info_repository, scanner_manager, catalog_service_client)
