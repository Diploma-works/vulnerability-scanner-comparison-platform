from fastapi import APIRouter
from fastapi import Depends
from starlette import status

from app.models.common import Id
from app.models.scan import ScanList, CreateScanRequest
from app.services import ScanService, get_scan_service

router = APIRouter(prefix="/scan", tags=["scan"])


@router.get(
    path="/",
    description="Список сканирований пользователя",
    response_model=ScanList,
)
async def get_scans(
        scan_service: ScanService = Depends(get_scan_service)
):
    return await scan_service.get_scans()


@router.post(
    path="/start",
    description="Запуск сканирования",
    status_code=status.HTTP_201_CREATED,
    response_model=Id,
)
async def start_scan(
        body: CreateScanRequest,
        scan_service: ScanService = Depends(get_scan_service)
):
    return await scan_service.start_scan(
        target_id=body.target_id, scanner_id=body.scanner_id, report_type=body.report_type,
        options=body.options
    )
