-- add analytic tables
-- depends: 20240505_01_uIRUO-add-scanner-exit-code-column
CREATE TABLE IF NOT EXISTS severity (
    id SMALLINT PRIMARY KEY NOT NULL,
    name varchar(30) NOT NULL
);

INSERT INTO severity(id, name)
VALUES (0, 'INFO'), (1, 'LOW'), (2, 'MEDIUM'), (3, 'HIGH'), (4, 'CRITICAL');

CREATE TABLE IF NOT EXISTS vulnerability (
    id SERIAL PRIMARY KEY NOT NULL,
    scan_id INTEGER NOT NULL,
    group_id INTEGER NOT NULL,
    severity_id INTEGER NOT NULL,
    name text NOT NULL,
    method text,
    url text,
    path text,
    vector text,
    params text,
    is_false_positive boolean
);

CREATE INDEX IF NOT EXISTS scan_id_severity_id_idx ON vulnerability(scan_id, severity_id);
CREATE INDEX IF NOT EXISTS scan_id_group_id_idx ON vulnerability(scan_id, group_id);

CREATE TABLE IF NOT EXISTS vulnerabilities_duplicates(
    vulner_id INTEGER PRIMARY KEY NOT NULL,
    duplicates_ids TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS scan_statistic (
    scan_id INTEGER PRIMARY KEY NOT NULL,

    info_count INTEGER,
    low_count INTEGER,
    medium_count INTEGER,
    high_count INTEGER,
    critical_count INTEGER,

    info_points float,
    low_points float,
    medium_points float,
    high_points float,
    critical_points float,

    total_points NUMERIC,

    false_positive_count INTEGER,
    true_positive_count INTEGER,
);


