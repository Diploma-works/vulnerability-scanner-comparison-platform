from asyncpg import PostgresError
from fastapi.requests import Request
from fastapi.responses import JSONResponse
from loguru import logger
from starlette import status


async def db_error_handler(_: Request, exception: PostgresError) -> JSONResponse:
    logger.error(exception)
    return JSONResponse(status_code=status.HTTP_500_INTERNAL_SERVER_ERROR, content={"reason": str(exception)})
