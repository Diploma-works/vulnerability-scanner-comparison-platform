from typing import List

from pypika import Table
from pypika.queries import QueryBuilder, Query

from app.db import BaseRepository
from app.models.vulnerability import VulnerabilityType, VulnerabilityGroup

vulnerabilities_types = Table('vulnerability_catalog')
vulnerability_group = Table('vulnerability_group')


class VulnerabilityRepository(BaseRepository):

    async def get_vulnerabilities(self) -> List[VulnerabilityType]:
        q: QueryBuilder = Query().from_(vulnerabilities_types).select('*')
        return await self.fetch_rows(q, serializer=VulnerabilityType)

    async def get_vulnerability_groups(self) -> List[VulnerabilityGroup]:
        q: QueryBuilder = Query().from_(vulnerability_group).select('*')
        return await self.fetch_rows(q, serializer=VulnerabilityGroup)
