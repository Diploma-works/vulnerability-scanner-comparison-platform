from typing import Optional, Union

from fastapi import APIRouter, Depends, Query

from app.models.scanner import ScannerList, Scanner, ReportOptionList, ReportOption
from app.services import ScannerService, get_scanner_service

router = APIRouter(prefix="/scanner", tags=["scanner"])


@router.get(
    path="/",
    description="Получение списка сканеров",
    response_model=ScannerList
)
async def get_scanners(
        scanner_service: ScannerService = Depends(get_scanner_service)
):
    return await scanner_service.get_scanners()


@router.get(
    path="/{scanner_id}",
    description="Получение сканера по id",
    response_model=Scanner
)
async def get_scanner_by_id(
        scanner_id: int,
        scanner_service: ScannerService = Depends(get_scanner_service)
):
    return await scanner_service.get_scanner_by_id(scanner_id)


@router.get(
    path="/{scanner_id}/report_option",
    description="Получение списка опций запуска сканера для генерации отчета",
    response_model=Union[ReportOption, ReportOptionList]
)
async def get_scanner_report_options(
        scanner_id: int,
        report_type: Optional[str] = Query(default=None),
        scanner_service: ScannerService = Depends(get_scanner_service)
):
    return await scanner_service.get_report_options(scanner_id, report_type)
