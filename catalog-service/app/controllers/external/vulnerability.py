from fastapi import APIRouter, Depends

from app.db import get_repository
from app.db.repositories.VulnerabilityRepository import VulnerabilityRepository
from app.models.vulnerability import VulnerabilityGroupsList, VulnerabilityTypesList

router = APIRouter(prefix="/vulnerability", tags=["vulnerability"])


@router.get(
    path="/list",
    description="Получение списка найденных уязвимостей",
    response_model=VulnerabilityTypesList
)
async def get_vulnerabilities(
        vulnerability_repository: VulnerabilityRepository = Depends(get_repository(VulnerabilityRepository))
):
    return VulnerabilityTypesList(types=await vulnerability_repository.get_vulnerabilities())


@router.get(
    path="/groups",
    description="Получение списка групп уязвимостей",
    response_model=VulnerabilityGroupsList
)
async def get_vulnerability_groups(
        vulnerability_repository: VulnerabilityRepository = Depends(get_repository(VulnerabilityRepository))
):
    return VulnerabilityGroupsList(groups=await vulnerability_repository.get_vulnerability_groups())
