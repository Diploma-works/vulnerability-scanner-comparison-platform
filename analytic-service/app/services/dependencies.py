from fastapi import Depends

from app.db import get_repository
from app.db.repositories.AnalyticRepository import AnalyticRepository
from app.services.AnalyticService import AnalyticService
from common.clients import get_catalog_service_client
from common.clients.catalog_service.CatalogServiceClient import CatalogServiceClient
from common.db.ScanRepository import ScanRepository
from common.db.VulnerabilityRepository import VulnerabilityRepository
from common.services.AnalyzeService import AnalyzeService


def get_analyze_service(
        scan_repo: ScanRepository = Depends(get_repository(ScanRepository)),
        vulner_repo: VulnerabilityRepository = Depends(get_repository(VulnerabilityRepository)),
        catalog_service_client: CatalogServiceClient = Depends(get_catalog_service_client)
):
    service = AnalyzeService()
    service.scan_repo = scan_repo
    service.vulner_repo = vulner_repo
    service.catalog_service_client = catalog_service_client
    return service


def get_analytic_service(
        scan_repo: ScanRepository = Depends(get_repository(ScanRepository)),
        analytic_repo: AnalyticRepository = Depends(get_repository(AnalyticRepository)),
        catalog_service_client: CatalogServiceClient = Depends(get_catalog_service_client)
):
    return AnalyticService(scan_repo, analytic_repo, catalog_service_client)
