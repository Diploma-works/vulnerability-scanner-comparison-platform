-- initial tables
-- depends: 

CREATE TABLE IF NOT EXISTS severity (
    id SERIAL PRIMARY KEY NOT NULL,
    name varchar(100) NOT NULL
);

INSERT INTO severity(id, name)
VALUES (0, 'INFO'), (1, 'LOW'), (2, 'MEDIUM'), (3, 'HIGH'), (4, 'CRITICAL');

CREATE TABLE IF NOT EXISTS vulnerability (
    id SERIAL PRIMARY KEY NOT NULL,
    scan_id INTEGER NOT NULL,
    vuln_group_id INTEGER NOT NULL,
    severity_id INTEGER NOT NULL,
    name TEXT NOT NULL,
    method TEXT,
    vector TEXT,
    url TEXT,
    path TEXT,
    query_params TEXT,
    is_false_positive BOOLEAN
);

CREATE TABLE IF NOT EXISTS vulnerability_duplicates (
    vulnerability_id INTEGER PRIMARY KEY NOT NULL,
    duplicate_ids TEXT NOT NULL
);

CREATE INDEX IF NOT EXISTS scan_id_severity_id_idx ON vulnerabilities(scan_id, severity_id);
CREATE INDEX IF NOT EXISTS scan_id_vuln_group_id_idx ON vulnerabilities(scan_id, vuln_group_id);